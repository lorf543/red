{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Summary Cards -->
    <div class="flex  sm:flex-cols-2 lg:flex-cols-4 gap-4 px-4 py-8">
        <!-- Total Votes Card -->
        <div class="card bg-surface text-text rounded-xl shadow-comment border border-border">
            <div class="card-body p-6">
                <h2 class="card-title text-lg font-semibold text-text mb-2">Total Votes</h2>
                <p class="text-3xl font-bold text-primary">{{ total_votes }}</p>
            </div>
        </div>

        <!-- Category Cards -->
        {% for category in categories %}
        <div class="card bg-surface text-text rounded-xl shadow-comment border border-border border-t-4 
            {% if category.color == 'green' %}border-success
            {% elif category.color == 'red' %}border-danger
            {% elif category.color == 'yellow' %}border-warning
            {% else %}border-primary{% endif %}">
            <div class="card-body p-6">
                <h2 class="card-title text-lg font-semibold text-text mb-2">{{ category.name }}</h2>
                
                <!-- Total votes for this category -->
                <p class="text-2xl font-bold 
                    {% if category.color == 'green' %}text-success
                    {% elif category.color == 'red' %}text-danger
                    {% elif category.color == 'yellow' %}text-warning
                    {% else %}text-primary{% endif %}">
                    {{ category.total }}
                </p>
                
                <!-- Top teacher in this category -->
                {% if category.top_teacher %}
                <div class="mt-4 pt-4 border-t border-border">
                    <p class="text-sm text-muted mb-1">Top Teacher:</p>
                    <div class="flex items-center gap-2">
                        <p class="font-medium text-text truncate">{{ category.top_teacher.full_name }}</p>
                        <span class="badge text-xs 
                            {% if category.color == 'green' %}bg-success/10 text-success border-success/20
                            {% elif category.color == 'red' %}bg-danger/10 text-danger border-danger/20
                            {% elif category.color == 'yellow' %}bg-warning/10 text-warning border-warning/20
                            {% else %}bg-primary/10 text-primary border-primary/20{% endif %}">
                            {{ category.top_votes }} votes
                        </span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Detailed Votes List -->
    <div class="card bg-surface text-text rounded-xl shadow-comment border border-border mb-8">
        <div class="card-body p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="card-title text-xl font-semibold text-text">Recent Votes</h2>
                <span class="text-sm text-muted">{{ votes|length }} votos</span>
            </div>
            
            <div class="space-y-4">
                {% for vote in votes %}
                <div class="flex items-start gap-4 p-4 rounded-lg border border-border hover:bg-surface-hover transition-colors duration-200">
                    <div class="flex-shrink-0">
                        {% if vote.user.profile.profile_picture %}
                            <img src="{{ vote.user.profile.profile_picture.url }}" 
                                 alt="{{ vote.user.username }}" 
                                 class="w-10 h-10 object-cover rounded-full border-2 border-surface">
                        {% else %}
                        <div class="w-10 h-10 rounded-full bg-primary text-primary-content border-2 border-surface flex items-center justify-center font-medium">
                            {{ vote.user.profile.get_profile_initials }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start gap-2 mb-2">
                            <div class="min-w-0">
                                <h4 class="font-medium text-text mb-1">
                                    <a href="{% url 'profile' vote.user.id %}" 
                                       class="text-primary hover:text-primary-dark hover:underline truncate block">
                                        {{ vote.user.username }}
                                    </a>
                                </h4>
                                {% if vote.teacher %}
                                <a href="{% url 'teacher_detail' vote.teacher.slug %}" 
                                   class="text-sm text-muted hover:text-primary transition-colors truncate block">
                                    {{ vote.teacher.full_name }}
                                </a>
                                {% elif vote.subject %}
                                <span class="text-sm text-muted truncate block">
                                    {{ vote.subject.name }}
                                </span>
                                {% endif %}
                            </div>
                            <span class="text-sm font-medium whitespace-nowrap
                                {% if vote.vote_type == 1 %}text-success
                                {% elif vote.vote_type == 2 %}text-danger
                                {% else %}text-warning{% endif %}">
                                {{ vote.get_vote_type_display }}
                            </span>
                        </div>
                        
                        {% if vote.comment %}
                        <div class="mt-3 p-3 bg-surface-hover rounded-lg border border-border">
                            <p class="text-sm text-text">{{ vote.comment }}</p>
                        </div>
                        {% endif %}
                        
                        <p class="text-xs text-muted mt-3 flex items-center gap-1">
                            <i class="far fa-clock"></i>
                            {{ vote.created_at|date:"M d, Y H:i" }}
                        </p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-12">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-surface-hover text-muted mb-4">
                        <i class="fas fa-star text-2xl"></i>
                    </div>
                    <p class="text-muted">No votes yet</p>
                    <p class="text-sm text-muted mt-1">Be the first to vote!</p>
                </div>
                {% endfor %}
            </div>
        </div>
        
        {% if votes.has_next %}
        <div class="card-actions justify-center p-6 border-t border-border">
            <button class="btn btn-outline btn-primary border-primary text-primary hover:bg-primary hover:text-primary-content px-8 py-2">
                Load More Votes
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}