{% extends "base.html" %}
{% block content %}

<div class="min-h-screen">
    <div class="max-w-5xl mx-auto px-4">
        <!-- Header -->
        <div class="mb-8">
            <a class="btn bg-surface" hx-boost="true" href="{% url 'blog_list' %}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Volver
            </a>
        </div>

        <!-- Formulario Principal -->
        <div class="rounded-xl p-8 border" 
             style="background-color: var(--color-surface); border-color: var(--color-border); box-shadow: var(--comment-shadow);">
            
            <h1 class="text-3xl font-bold mb-6 pb-4 border-b" 
                style="color: var(--color-text); border-color: var(--color-border);">
                Crear Nuevo Blog
            </h1>

            <form method="post" enctype="multipart/form-data" id="blog-form">
                {% csrf_token %}

                <!-- Título -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" style="color: var(--color-text);">
                        Título del Blog
                    </label>
                    <input type="text" 
                           name="title" 
                           required
                           class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
                           style="background-color: var(--color-background); border-color: var(--color-border); color: var(--color-text); --tw-ring-color: var(--color-primary);"
                           placeholder="Escribe el título de tu blog...">
                </div>

                <!-- Subtítulo -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" style="color: var(--color-text);">
                        Subtítulo (opcional)
                    </label>
                    <input type="text" 
                           name="subtitle" 
                           class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
                           style="background-color: var(--color-background); border-color: var(--color-border); color: var(--color-text); --tw-ring-color: var(--color-primary);"
                           placeholder="Un subtítulo breve...">
                </div>

                <!-- Imagen Principal -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" style="color: var(--color-text);">
                        Imagen Principal
                    </label>
                    <div class="flex items-center gap-4">
                        <label class="btn btn-outline cursor-pointer" style="border-color: var(--color-border); color: var(--color-text);">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Seleccionar imagen
                            <input type="file" name="main_image" class="hidden" accept="image/*" id="main-image-input">
                        </label>
                        <span id="image-name" class="text-sm" style="color: var(--color-muted);">Ninguna imagen seleccionada</span>
                    </div>
                </div>

                <!-- Párrafo Principal -->
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2" style="color: var(--color-text);">
                        Párrafo Principal (Introducción)
                    </label>
                    <textarea name="main_paragraph" 
                              required
                              rows="5"
                              class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2"
                              style="background-color: var(--color-background); border-color: var(--color-border); color: var(--color-text); --tw-ring-color: var(--color-primary);"
                              placeholder="Escribe la introducción de tu blog..."></textarea>
                </div>

                <!-- Tags -->
                <div class="mb-8">
                    <label class="block text-sm font-medium mb-2" style="color: var(--color-text);">
                        Tags
                    </label>
                    <div class="flex flex-wrap gap-2" style="padding: 1rem; background-color: var(--color-background); border-radius: 0.5rem;">
                        {% for tag in available_tags %}
                        <label class="cursor-pointer">
                            <input type="checkbox" name="tags" value="{{ tag.id }}" class="hidden peer">
                            <span class="px-3 py-1.5 text-sm rounded-full transition-all peer-checked:ring-2"
                                  style="background-color: color-mix(in srgb, {{ tag.color }} 10%, transparent); 
                                         color: {{ tag.color }}; 
                                         border: 1px solid color-mix(in srgb, {{ tag.color }} 20%, transparent);
                                         --tw-ring-color: {{ tag.color }};">
                                {{ tag.name }}
                            </span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- Secciones del Blog -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold" style="color: var(--color-text);">
                            Secciones del Blog
                        </h2>
                        <button type="button" 
                                class="btn btn-sm"
                                style="background-color: var(--color-primary); color: white;"
                                hx-post="{% url 'add_section_form' %}"
                                hx-target="#sections-container"
                                hx-swap="beforeend">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Agregar Sección
                        </button>
                    </div>

                    <!-- Contenedor de Secciones -->
                    <div id="sections-container" class="space-y-4">
                        <!-- Las secciones se agregarán aquí dinámicamente -->
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="flex gap-4 pt-6 border-t" style="border-color: var(--color-border);">
                    <button type="submit" 
                            name="action" 
                            value="draft"
                            class="btn flex-1"
                            style="background-color: var(--color-muted); color: var(--color-text);">
                        Guardar como Borrador
                    </button>
                    <button type="submit" 
                            name="action" 
                            value="publish"
                            class="btn flex-1"
                            style="background-color: var(--color-primary); color: white;">
                        Publicar Blog
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Contador para secciones
    let sectionCount = 0;

    // Preview de imagen
    document.getElementById('main-image-input').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || 'Ninguna imagen seleccionada';
        document.getElementById('image-name').textContent = fileName;
    });

    // Manejar eliminación de secciones
    document.addEventListener('click', function(e) {
        if (e.target.closest('.remove-section')) {
            e.target.closest('.section-item').remove();
        }
    });
</script>

{% endblock content %}